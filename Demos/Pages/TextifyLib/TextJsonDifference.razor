@page "/text/json/difference"

<PageTitle>Textify - JSON - Difference - Aptivi Project Demos</PageTitle>

@using System.Threading;
@using System.Net;
@using System.Text;
@using System.IO
@using System.Text.Json
@using Demos.Data
@using Newtonsoft.Json
@using Newtonsoft.Json.Linq
@using Textify.Data.Figlet
@using Textify.Tools
@inject NavigationManager NavManager

<Hero Title="Textify - JSON - Difference">
	You can demonstrate a feature from Textify where we showcase the text casing feature,
	and we provide the API documentation here for future reference. This demonstrates the
	"Find difference between two different JSON representations" feature.
</Hero>
<BrandedBorder>
	<div class="d-grid gap-2 d-sm-flex">
		<div class="col d-flex align-items-start">
			<div>
				<p>Enter source JSON text</p>
				<InputTextArea class="form-text" @bind-Value="Source"></InputTextArea>
			</div>
			<div>
				<p>Enter target JSON text</p>
				<InputTextArea class="form-text" @bind-Value="Target"></InputTextArea>
			</div>
		</div>
	</div>
	<p>Result from <code>FindDifferences()</code></p>
	@if (Result is not null)
	{
		<pre>@Result</pre>
    }
    else if (Errored)
    {
        <p>Error obtaining results: @ErrorReason</p>
    }
	<div class="d-grid gap-2 d-sm-flex">
		<button class="btn btn-primary btn-lg" type="button" @onclick="@ClickEvents[0]">Analyze</button>
		<button class="btn btn-primary btn-lg" type="button" @onclick="@ClickEvents[1]">API Reference</button>
	</div>
</BrandedBorder>

@code {
	public string Source { get; set; } = "{\"text\": \"Hello world!\", \"text2\": \"No text\"}";
    public string Target { get; set; } = "{\"text\": \"Hello, world!\"}";
    public bool Errored { get; set; } = false;
    public string ErrorReason { get; set; } = "";
	public string Result { get; set; }
	public EventCallback[] ClickEvents => [
		EventCallback.Factory.Create(this, ProcessInput),
		EventCallback.Factory.Create(this, new Action(() => NavManager.NavigateTo("https://aptivi.github.io/Textify/api/Textify.Tools.JsonTools.html#Textify_Tools_JsonTools_FindDifferences_Newtonsoft_Json_Linq_JToken_Newtonsoft_Json_Linq_JToken_"))),
	];

	public void ProcessInput()
    {
        try
        {
            Errored = false;
            var parsedSource = JToken.Parse(Source);
            var parsedTarget = JToken.Parse(Target);
            Result = JsonTools.FindDifferences(parsedSource, parsedTarget).ToString(Formatting.Indented);
        }
        catch (Exception ex)
        {
            Errored = true;
            ErrorReason = ex.Message;
        }
	}
}
